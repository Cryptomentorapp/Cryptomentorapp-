import 'dart:convert'; import 'package:flutter/material.dart'; import 'package:http/http.dart' as http; import '../widgets/cm_card.dart'; class MarketPage extends StatefulWidget{ const MarketPage({super.key}); @override State<MarketPage> createState()=>_M(); } class _M extends State<MarketPage>{ List<dynamic> items=[]; bool loading=false; String? error; @override void initState(){ super.initState(); fetch(); } Future<void> fetch() async{ setState(()=>loading=true); try{ final res=await http.get(Uri.parse('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=25&page=1&sparkline=false')); if(res.statusCode==200){ items=jsonDecode(res.body); error=null;} else { error='HTTP '+res.statusCode.toString(); } } catch(e){ error=e.toString(); } setState(()=>loading=false); } @override Widget build(BuildContext c){ if(loading) return const Center(child:CircularProgressIndicator()); if(error!=null) return Center(child: Text('Error: '+error!)); return RefreshIndicator(onRefresh: fetch, child: ListView.separated(padding: const EdgeInsets.all(12), itemCount: items.length, itemBuilder:(_,i){ final m=Map<String,dynamic>.from(items[i]); return CMCard(child: Row(children:[ CircleAvatar(backgroundImage: NetworkImage((m['image']??'').toString())), const SizedBox(width:12), Expanded(child: Column(crossAxisAlignment: CrossAxisAlignment.start, children:[ Text((m['name']??'').toString()+' ('+(m['symbol']??'').toString().toUpperCase()+')', style: const TextStyle(fontWeight: FontWeight.w600)), Text('Price: '+((m['current_price'] is num)? (m['current_price'] as num).toStringAsFixed(4):'-')), ])), ])); }, separatorBuilder:(_,__)=>const SizedBox(height:8))); } }